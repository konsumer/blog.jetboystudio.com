
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="I had a need for a mongodb-driven tagging widget. The idea is that you get nice tags that you can add &amp; remove, and it knows about tags that are already present.">
    <meta name="author" content="David Konsumer">
    <title>Bootstrap tagging - Drunken Coder Blog</title>
    <link rel="alternate" href="http://blog.jetboystudio.com//feed.xml" type="application/rss+xml" title="a blog about code &amp; life">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/tomorrow.min.css">
    <meta property="og:site_name" content="Drunken Coder Blog"/>
    <meta property="og:description" content="I had a need for a mongodb-driven tagging widget. The idea is that you get nice tags that you can add &amp; remove, and it knows about tags that are already present.">
    <meta property="og:image" content="http://blog.jetboystudio.com//favicon.ico"/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="page-article" id="wrap">
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img width="20" height="20" src="/favicon.ico"> Drunken Coder Blog</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav addthis_toolbox addthis_default_style addthis_32x32_style">
              <li><a href="/">Home</a></li>
              <li><a href="/archive.html">Archive</a></li>
              <li><a class="addthis_button addthis_button addthis_button_facebook"></a></li>
              <li><a class="addthis_button addthis_button addthis_button_twitter"></a></li>
              <li><a class="addthis_button addthis_button addthis_button_google_plusone_share"></a></li>
              <li><a class="addthis_button addthis_button addthis_button_compact"></a><a class="addthis_button addthis_counter addthis_bubble_style"></a></li>
              <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=xa-52a4a9a2159a1d9a"></script>
            </ul>
          </div>
        </div>
      </div>

      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <div class="container">
        <div class="page-header">
          <h2><a href="/articles/bootstrap-tagging/">Bootstrap tagging</a></h2>
          
          <ul class="tags"> <li>quickie</li>  <li>tagging</li>  <li>bootstrap</li>  <li>node</li>  <li>express</li>  <li>mongoose</li>  <li>mongodb</li> </ul>
          <div class="date">Nov 11th, 2013</div>
        </div>
        <div><p>I had a need for a mongodb-driven tagging widget. The idea is that you get nice tags that you can add &amp; remove, and it knows about tags that are already present.</p>
<hr>
<p>First, get some cheap beer, and a bottle of Amaretto. Alternate swigs, and read on.</p>
<p>I was haing a lot of trouble with various parts of this. I think I just needed a bit o’ gangster-rap &amp; Amaretto. Maybe with my help your roll will be smooth-sails.</p>
<p>Ok, so first I have a cute lil express.js app. I will detail the entire process.</p>
<p>Run <code>npm init</code> to create a new node package.json. Just answer the questions.</p>
<p>Run <code>npm install --save express &amp;&amp; npm install --save mongoose</code> to add express &amp; mongoose to your project.</p>
<p>You can head over to <a href="https://mongolab.com/">mongolab</a> to get a free mongodb, if you don’t want to host it yourself.</p>
<p>make your server.js look like this:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> express = require(<span class="string">'express'</span>),
    app = express(),
    mongoose = require(<span class="string">'mongoose'</span>),
    MyModel = require(<span class="string">'./models/MyModel'</span>);

mongoose.connect(require(<span class="string">'./config.json'</span>).database);

app.configure(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    app.use(express.bodyParser());
    app.use(express.methodOverride());
    app.use(<span class="string">"/"</span>, express.static(<span class="string">'public'</span>));
    app.use(app.router);

    app.use(express.logger(<span class="string">'\x1b[33m:method\x1b[0m \x1b[32m:url\x1b[0m :response-time'</span>));
    app.use(express.errorHandler({
        dumpExceptions: <span class="literal">true</span>,
        showStack: <span class="literal">true</span>
    }));
});

<span class="comment">// get a list of available tags</span>
app.get(<span class="string">'/d/tags'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>{</span>
    <span class="comment">// you can put strings in here to preseed tags. slick!</span>
    MyModel.find().distinct(<span class="string">'tags'</span>, <span class="function"><span class="keyword">function</span><span class="params">(er, d)</span>{</span>
    <span class="keyword">var</span> out = [<span class="string">"hipster trash"</span>, <span class="string">"euro trash"</span>, <span class="string">"foolish whim"</span>, <span class="string">"good idea"</span>];
        <span class="keyword">if</span> (er) <span class="keyword">return</span> res.send(<span class="number">500</span>, er);
        res.send(out.concat(d));
    });
});

<span class="keyword">var</span> port = require(<span class="string">'./config.json'</span>).port || <span class="number">8000</span>;
console.log(<span class="string">'come see us at http://0.0.0.0:'</span> + port);

app.listen(port);</code></pre>
<p>all the <code>app.configure</code> stuff is me getting fancy. Totally optional if you are running a static webserver somewhere else.</p>
<p>If you don’t need to preseed your auto-complete list, make your callback look like this fancy (simple) bee-yute:</p>
<pre><code class="lang-javascript"><span class="comment">// get a list of available tags</span>
app.get(<span class="string">'/d/tags'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>{</span>
    MyModel.find().distinct(<span class="string">'tags'</span>, <span class="function"><span class="keyword">function</span><span class="params">(er, d)</span>{</span>
        <span class="keyword">if</span> (er) <span class="keyword">return</span> res.send(<span class="number">500</span>, er);
        res.send(d);
    });
});</code></pre>
<p>There is also a config file called <code>config.json</code>:</p>
<pre><code class="lang-json">{
    "<span class="attribute">database</span>": <span class="value"><span class="string">"mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@&lt;dbhost&gt;:&lt;dbport&gt;/&lt;dbname&gt;"</span>
</span>}</code></pre>
<p>Make sure to add that to .gitignore. Alternately, you can just fill in the mongo URI, above.</p>
<p><code>MyModel</code> is an example model. Make sure it has a “tags” string-array field. Let’s make a lil cutie in <code>models/MyModel.js</code> that looks kinda like this:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> mongoose = require(<span class="string">'mongoose'</span>);

<span class="keyword">var</span> MyModel = <span class="keyword">new</span> mongoose.Schema({
    <span class="string">"name"</span>: String,
    <span class="string">"description"</span>: String,
    <span class="string">"cool"</span>: Boolean,
    <span class="string">"tags"</span>: [String],

    <span class="string">"hipster.cool"</span>: Boolean,
    <span class="string">"hipster.ironic"</span>: Boolean,
    <span class="string">"hipster.poser"</span>: Boolean
});

module.exports = mongoose.model(<span class="string">'MyModel'</span>, MyModel);</code></pre>
<p>As a sidenote, I realized how to make models in mongoose have a nice Object structure, without pseudo-sub documents (extra ids &amp; overhead.) All you gotta do is name fields things like <code>thing.field</code>. super-cool!</p>
<p>Make a lil dev script to insert a bunch of records, mine is silly, feel free to tailor to your own sweet-sweet model.</p>
<p>I am using my awesome <a href="https://github.com/konsumer/randopeep">randopeep</a> lib. Install with <code>npm install --save-dev randopeep</code></p>
<p>let’s call this file <code>genenerate-hipsters.js</code> and run it with <code>node genenerate-hipsters.js</code></p>
<pre><code class="lang-javascript"><span class="keyword">var</span> mongoose = require(<span class="string">'mongoose'</span>),
    randopeep = require(<span class="string">'randopeep'</span>);
    MyModel = require(<span class="string">'./models/MyModel'</span>);

mongoose.connect(require(<span class="string">'./config.json'</span>).database);

<span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++){
    <span class="keyword">var</span> rec = {
        <span class="string">"name"</span>: randopeep.corporate.name(<span class="string">'cyber'</span>),
        <span class="string">"description"</span>: randopeep.corporate.catchPhrase(),
        <span class="string">"cool"</span>: Math.random() &gt;= <span class="number">0.5</span>,
        <span class="string">"tags"</span>: [],
        <span class="string">"hipster"</span>:{
            <span class="string">"cool"</span>: Math.random() &gt;= <span class="number">0.5</span>,
            <span class="string">"ironic"</span>: Math.random() &gt;= <span class="number">0.5</span>,
            <span class="string">"poser"</span>: Math.random() &gt;= <span class="number">0.5</span>
        }
    };

    rec.tags = rec.tags.concat(randopeep.invention(<span class="number">25</span>));
    rec.tags = rec.tags.concat(randopeep.job(<span class="number">25</span>));

    <span class="keyword">var</span> s = <span class="keyword">new</span> MyModel(rec);
    s.save();

    console.log(s);
}</code></pre>
<p>This will generate 100 nice random MyModels, with 50 tags each.</p>
<p>OK! now, for the client-side code, put this in public/index.html like a champ:</p>
<pre><code class="lang-html">&lt;link rel=&quot;stylesheet&quot; href=&quot;http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css&quot;&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdnjs.cloudflare.com/ajax/libs/tagmanager/3.0.0/tagmanager.css&quot;&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://raw.github.com/jharding/typeahead.js-bootstrap.css/master/typeahead.js-bootstrap.css&quot;&gt;

&lt;script src=&quot;http://codeorigin.jquery.com/jquery-1.10.2.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;http://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.9.3/typeahead.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;http://cdnjs.cloudflare.com/ajax/libs/tagmanager/3.0.0/tagmanager.js&quot;&gt;&lt;/script&gt;

&lt;div class=&quot;container&quot;&gt;
    &lt;form class=&quot;form-horizontal&quot; role=&quot;form&quot;&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;tags&quot;&gt;Tags:&lt;/label&gt;
        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;tags&quot;&gt;
      &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;script&gt;
var tagger = $(&#39;#tags&#39;).tagsManager();
$(&quot;#tags&quot;).typeahead({
    prefetch: &#39;/d/tags&#39;
}).on(&#39;typeahead:selected&#39;, function (e, d) {
    tagger.tagsManager(&quot;pushTag&quot;, d.value);
});
&lt;/script&gt;</code></pre>
<p>Run <code>npm start</code> and you will have a running webserver &amp; JSON interface to your db’s tags.</p>
<p>Now, yer all set. It still needs a little style love, but basically does what is needed. Pretty extreme level of magic for such a small investment, eh?</p>
</div>
        
      </div>
      
      <div class="container" id="disqus_thread"></div>
      <script type="text/javascript">
          var disqus_shortname = 'jetboystudio';
          var ga_code = 'UA-2392079-5';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();

          // old code, have upgraded...
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', ga_code]);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div> <!-- /#wrap -->

    <div id="footer">
      <div class="container">
        <p class="text-muted credit">© 2013 David Konsumer</p>
      </div>
    </div>

    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>

  </body>
</html>



