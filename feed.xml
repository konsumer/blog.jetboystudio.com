<?xml version="1.0" encoding="utf-8" ?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:wfw="http://wellformedweb.org/CommentAPI/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Drunken Coder Blog</title>
    <atom:link href="http://blog.jetboystudio.com/feed.xml" rel="self" type="application/rss+xml"></atom:link>
    <link>http://blog.jetboystudio.com</link>
    <description>you can do it well, even if you&#x27;re drunk</description>
    <generator>Wintersmith - https://github.com/jnordberg/wintersmith</generator>
    <language>en</language>

	    <item>
	    	<title>Staging Server with Dokku</title>
	    	<link>http://blog.jetboystudio.com/articles/dokku/</link>
	    	<guid isPermaLink="true">http://blog.jetboystudio.com/articles/dokku/</guid>
	    	<pubDate>Thu, 30 Jun 2016 10:12:49 -0700</pubDate>
	    	<author></author>
	    	<description>&lt;p&gt;Here is how I setup my staging server to show clients progress.&lt;/p&gt;
&lt;p&gt;It’s been a really very long time since I wrote something. Sorry about that. Been super-busy drinking &amp;amp; coding!&lt;/p&gt;
&lt;h2 id=&quot;what-are-you-tryng-to-do-&quot;&gt;what are you tryng to do?&lt;/h2&gt;
&lt;p&gt;I manage systems like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;local development, tracked with git, current on master: run &lt;code&gt;npm start&lt;/code&gt; for dev server, &lt;code&gt;npm test&lt;/code&gt; to run unit-tests.&lt;/li&gt;
&lt;li&gt;git push to staging (either master or a branch)&lt;/li&gt;
&lt;li&gt;git push to production (either master or a branch)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I really like the ease of deploying to &lt;a href=&quot;https://www.heroku.com/&quot;&gt;heroku&lt;/a&gt;, but thought I could run my own cheaper. I also want to be able to deploy &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; apps.&lt;/p&gt;
&lt;h2 id=&quot;dokku&quot;&gt;dokku&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/dokku/dokku&quot;&gt;dokku&lt;/a&gt; lets you do all these things. I set mine up on &lt;a href=&quot;https://www.digitalocean.com/?refcode=333f9dfd59df&amp;amp;utm_campaign=Referral_Invite&amp;amp;utm_medium=Referral_Program&quot;&gt;Digital Ocean&lt;/a&gt; on the cheap (about $20 a month.) I use this to host all my staging sites.&lt;/p&gt;
&lt;h3 id=&quot;setting-up-the-server&quot;&gt;setting up the server&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Go to &lt;a href=&quot;https://www.digitalocean.com/?refcode=333f9dfd59df&amp;amp;utm_campaign=Referral_Invite&amp;amp;utm_medium=Referral_Program&quot;&gt;Digital Ocean&lt;/a&gt; to setup an account (that link gives you $10 credit.)&lt;/li&gt;
&lt;li&gt;Click “Create Droplet” and “One-click Apps” choose the $20/month size &amp;amp; “Dokku 0.6.2 on 14.04”.&lt;/li&gt;
&lt;li&gt;Set your SSH key and hostname, click “Create”&lt;/li&gt;
&lt;li&gt;Once it spins up, add all your user’s SSH public-keys with this command: &lt;code&gt;cat /path/to/public_key | ssh root@yourdokkuinstance &amp;quot;sudo sshcommand acl-add dokku [description]&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;setup-dns&quot;&gt;setup DNS&lt;/h3&gt;
&lt;p&gt;The IP of my Digial Ocean instance is &lt;code&gt;192.241.239.28&lt;/code&gt;. I use enom for DNS. I setup a host record like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;*  - A  -  192.241.239.28
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This means “send everyone who asks for a domain that hasn’t been accounted for to my digital oceon box.”&lt;/p&gt;
&lt;p&gt;I have the bare domain and www setup, so now I can make &lt;code&gt;http://whatever.jetboystudio.com&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;setup-a-project&quot;&gt;setup a project&lt;/h3&gt;
&lt;p&gt;We are going to make a simple lil mostly-static site that gives instructions, and let’s users quickly send an email to me to add their key (with the above command.) I could make a fancy admin, but I just want it to be fast and simple. You can see what I did at &lt;a href=&quot;http://dev.jetboystudio.com/&quot;&gt;dev.jetboystudio.com&lt;/a&gt;. For the sake of simplicity, I will just use my domain below, but you will need to change it to yours.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Get site with &lt;code&gt;git clone https://github.com/konsumer/dev.git &amp;amp;&amp;amp; cd dev &amp;amp;&amp;amp; npm i&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Run local with &lt;code&gt;npm start&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Put in your own name, email, and configure stuff. Make it useful to devs.&lt;/li&gt;
&lt;li&gt;Add your staging server with &lt;code&gt;git remote add dev dokku@dev.jetboystudio.com:dev&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Push with &lt;code&gt;git push dev master&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now the default is the info-site for deploying to dev. You can add a remote like &lt;code&gt;git remote add staging dokku@dev.jetboystudio.com:WHATEVER&lt;/code&gt; to any project and it will be at &lt;code&gt;http://WHATEVER.jetboystudio.com&lt;/code&gt;, and you can push with &lt;code&gt;git push staging master&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&quot;notes&quot;&gt;notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;I am using a node Dockerfile (ficusio/node-alpine:onbuild) with &lt;a href=&quot;https://github.com/ForbesLindesay/browserify-middleware&quot;&gt;browserify-middleware&lt;/a&gt;, instead of building on deploy once with static service. It builds and caches on first access, so I don’t really mind and it seemed simpler than getting builds working and setting up nginx static forwarding, but that would be better (more efficient, faster, etc.)&lt;/li&gt;
&lt;li&gt;I used &lt;a href=&quot;https://auth0.com/&quot;&gt;auth0&lt;/a&gt; to provide auth for github (so people can get a list of their public keys really quickly)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/konsumer/dev&quot;&gt;Here&lt;/a&gt; is the code.&lt;/li&gt;
&lt;/ul&gt;
</description>
		</item>

</channel>
</rss>